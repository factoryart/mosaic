(function(){var a,b,c=[].slice;a=function(){function a(c,d){var e,f;this.element=c,this.photos=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),a.instances.push(this),this.element.mosaic=this,e=null!=(f=a.optionsForElement(this.element))?f:{},this.options=b({},this.defaultOptions,e,null!=d?d:{}),this.init()}var b;return a.prototype.defaultOptions={density:5,interval:5e3,items:".item",in:"fadeIn",out:"fadeOut",replace:1,url:"/photos.json"},b=function(){var a,b,d,e,f,g,h;for(e=arguments[0],d=2<=arguments.length?c.call(arguments,1):[],g=0,h=d.length;g<h;g++){b=d[g];for(a in b)f=b[a],e[a]=f}return e},a.prototype.addPhoto=function(a){return this.photos.push(a)},a.prototype.removePhotos=function(){return this.photos=[]},a.prototype.items=function(){return $(this.element).find(this.options.items)},a.prototype.active_items=function(){return this.items().filter(".active")},a.prototype.non_active_items=function(){return this.items().not(".active")},a.prototype.simultaneous_photos_count=function(){return Math.round(this.items().length/(100/(10*this.options.density)))},a.prototype.shuffle=function(a){var b,c,d;for(c=a.length,d=void 0,b=void 0;c;)b=Math.floor(Math.random()*c--),d=a[c],a[c]=a[b],a[b]=d;return a},a.prototype.push_photo=function(){return this.photos.push(this.photos.shift())},a.prototype.clear=function(a){var b;return null==a&&(a=this.active_items().length),b=this.shuffle(this.active_items()).slice(this.active_items().length-a),b.addClass(this.options.out),b.removeClass("active"),b.removeAttr("style")},a.prototype.draw=function(a){return null==a&&(a=this.simultaneous_photos_count()),this.clear(a),this.shuffle(this.non_active_items()).slice(this.non_active_items().length-a).each(function(a){return function(b,c){return $(c).removeClass(a.defaultOptions.out),$(c).addClass("animated active").addClass(a.options.in),$(c).css("background-image","url("+a.photos[0].asset+")"),$(c).find("img").attr("title",a.photos[0].title),$(c).find("img").attr("alt",a.photos[0].title),a.push_photo()}}(this))},a.prototype.startDrawing=function(){return this.draw(),setInterval(function(a){return function(){a.draw(a.options.replace)}}(this),this.options.interval)},a.prototype.retrieve=function(){return $.getJSON(this.options.url).done(function(a){return function(b){return $.each(a.shuffle(b),function(b,c){return a.addPhoto(c)}),a.startDrawing()}}(this)).fail(function(a,b,c){var d;return d=b+", "+c,console.log("Request Failed: "+d)})},a.prototype.init=function(){return this.retrieve(),this.clear()},a}(),a.options={},a.optionsForElement=function(c){return c.getAttribute("id")?a.options[b(c.getAttribute("id"))]:void 0},a.instances=[],b=function(a){return a.replace(/[\-_](\w)/g,function(a){return a.charAt(1).toUpperCase()})},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.mosaic=function(b){return this.each(function(){return new a(this,b)})}),"undefined"!=typeof module&&null!==module?module.exports=a:window.Mosaic=a}).call(this);